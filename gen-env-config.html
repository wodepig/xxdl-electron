<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Envé…ç½®ç”Ÿæˆå™¨</title>
  <!-- å¼•å…¥Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- å¼•å…¥Font Awesome -->
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">

  <!-- Tailwindé…ç½® -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#3b82f6',
            secondary: '#64748b',
            accent: '#10b981',
            dark: '#1e293b',
            light: '#f8fafc',
            danger: '#ef4444',
            hint: '#94a3b8' // æç¤ºæ–‡æœ¬é¢œè‰²
          },
          fontFamily: {
            sans: ['Inter', 'system-ui', 'sans-serif'],
          },
        },
      }
    }
  </script>

  <style type="text/tailwindcss">
    @layer utilities {
      .config-card {
        @apply bg-white rounded-lg shadow-md p-6 mb-6 transition-all hover:shadow-lg;
      }
      .form-label {
        @apply block text-sm font-medium text-gray-700;
      }
      .form-label-required {
        @apply form-label after:content-['*'] after:text-danger after:ml-1;
      }
      .form-hint {
        @apply block text-xs text-hint mb-2; /* æç¤ºæ–‡æœ¬æ ·å¼ */
      }
      .form-input {
        @apply w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-colors;
      }
      .form-input-error {
        @apply border-danger focus:ring-danger/50 focus:border-danger;
      }
      .error-text {
        @apply text-danger text-xs mt-1 hidden;
      }
      .error-text.show {
        @apply block;
      }
      .section-title {
        @apply text-lg font-semibold text-dark mb-4 flex items-center gap-2;
      }
      .btn {
        @apply px-4 py-2 rounded-md font-medium transition-all focus:outline-none focus:ring-2 focus:ring-offset-2;
      }
      .btn-primary {
        @apply bg-primary text-white hover:bg-primary/90 focus:ring-primary/50;
      }
      .btn-secondary {
        @apply bg-gray-200 text-gray-800 hover:bg-gray-300 focus:ring-gray-400;
      }
      .btn-danger {
        @apply bg-danger text-white hover:bg-danger/90 focus:ring-danger/50;
      }
      .action-btn {
        @apply flex flex-col gap-4; /* æŒ‰é’®åŒºå¸ƒå±€ */
      }
      .link-row {
        @apply flex gap-3 items-end mb-3;
      }
      .link-row-input {
        @apply flex-1;
      }
    }
  </style>
</head>
<body class="bg-gray-50 min-h-screen">
<div class=" mx-auto px-40 py-8"> <!-- åŠ å®½å®¹å™¨é€‚é…ä¸‰åˆ—å¸ƒå±€ -->
  <header class="text-center mb-8">
    <h1 class="text-[clamp(1.8rem,4vw,2.5rem)] font-bold text-dark mb-2">Envé…ç½®ç”Ÿæˆå™¨</h1>
    <p class="text-secondary">è½»æ¾ç”Ÿæˆå’Œç®¡ç†ä½ çš„ç¯å¢ƒé…ç½®æ–‡ä»¶</p>
  </header>

  <!-- å·¦ä¸­å³ä¸‰åˆ—å¸ƒå±€ï¼šé¢„è§ˆåŒº | é…ç½®åŒº | æŒ‰é’®åŒº -->
  <div class="flex flex-col lg:flex-row gap-6">
    <!-- å·¦ä¾§ï¼šé¢„è§ˆåŒºï¼ˆå›ºå®šå®½åº¦ï¼‰ -->
    <div class="w-full lg:w-1/4">
      <section class="config-card h-full sticky top-8"> <!-- ç²˜æ€§å¸ƒå±€ï¼Œæ»šåŠ¨æ—¶å›ºå®š -->
        <h2 class="section-title">
          <i class="fa fa-eye text-primary"></i> é…ç½®æ–‡ä»¶é¢„è§ˆ
        </h2>
        <div class="flex items-center mb-3 flex-wrap">
          <label class="form-label mr-2">æ–‡ä»¶åï¼š</label>
          <input type="text" id="fileName" value=".env" class="form-input w-32 mb-2 sm:mb-0">
          <p class="form-hint ml-2">é…ç½®æ–‡ä»¶çš„åç§°ï¼Œé»˜è®¤.env</p>
        </div>
        <div class="relative">
          <pre id="configPreview" class="bg-gray-900 text-gray-100 p-4 rounded-md overflow-auto h-96 whitespace-pre-wrap"></pre>
          <button id="copyBtn" class="btn btn-secondary absolute top-2 right-2 text-sm">
            <i class="fa fa-copy mr-1"></i> å¤åˆ¶
          </button>
        </div>
      </section>
    </div>

    <!-- ä¸­é—´ï¼šé…ç½®åŒºï¼ˆå¼¹æ€§å®½åº¦ï¼Œä¸»è¦å†…å®¹åŒºï¼‰ -->
    <div class="w-full lg:flex-1">
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <!-- UpgradeLinké…ç½®åŒº -->
        <section class="config-card">
          <h2 class="section-title">
            <i class="fa fa-link text-primary"></i> UpgradeLinké…ç½®
          </h2>
          <div class="space-y-4">
            <div>
              <label for="VITE_UL_CONF_AK" class="form-label-required">VITE_UL_CONF_AK</label>
              <p class="form-hint">UpgradeLinkå¹³å°ä¸­çš„Ak</p>
              <input type="text" id="VITE_UL_CONF_AK" class="form-input">
              <p class="error-text" id="VITE_UL_CONF_AK_error">è¯·å¡«å†™UpgradeLinkå¹³å°çš„AK</p>
            </div>
            <div>
              <label for="VITE_UL_CONF_SK" class="form-label-required">VITE_UL_CONF_SK</label>
              <p class="form-hint">UpgradeLinkå¹³å°ä¸­çš„SK</p>
              <input type="text" id="VITE_UL_CONF_SK" class="form-input">
              <p class="error-text" id="VITE_UL_CONF_SK_error">è¯·å¡«å†™UpgradeLinkå¹³å°çš„SK</p>
            </div>
            <div>
              <label for="VITE_UL_CONF_FILEKEY" class="form-label-required">VITE_UL_CONF_FILEKEY</label>
              <p class="form-hint">UpgradeLinkå¹³å°ä¸­çš„FileKey</p>
              <input type="text" id="VITE_UL_CONF_FILEKEY" class="form-input">
              <p class="error-text" id="VITE_UL_CONF_FILEKEY_error">è¯·å¡«å†™UpgradeLinkå¹³å°çš„FileKey</p>
            </div>
            <div>
              <label for="VITE_UL_CONF_URL" class="form-label-required">VITE_UL_CONF_URL</label>
              <p class="form-hint">ç¨‹åºå¯åŠ¨åæ‰“å¼€çš„åœ°å€ï¼Œé»˜è®¤http://localhost:3000</p>
              <input type="text" id="VITE_UL_CONF_URL" class="form-input" value="http://localhost:3000">
              <p class="error-text" id="VITE_UL_CONF_URL_error">è¯·å¡«å†™ç¨‹åºå¯åŠ¨åæ‰“å¼€çš„åœ°å€</p>
            </div>
          </div>
        </section>

        <!-- åº”ç”¨åŸºæœ¬é…ç½®åŒº -->
        <section class="config-card">
          <h2 class="section-title">
            <i class="fa fa-cog text-primary"></i> åº”ç”¨åŸºæœ¬é…ç½®
          </h2>
          <div class="space-y-4">
            <div>
              <label for="VITE_APP_NAME" class="form-label-required">VITE_APP_NAME</label>
              <p class="form-hint">åº”ç”¨åï¼Œé»˜è®¤æ˜¯å‹ç¼©åŒ…åç§°å’Œexeçš„åç§°</p>
              <input type="text" id="VITE_APP_NAME" class="form-input" value="_">
              <p class="error-text" id="VITE_APP_NAME_error">è¯·å¡«å†™åº”ç”¨åç§°</p>
            </div>
            <div>
              <label for="VITE_APP_EXE_NAME" class="form-label-required">VITE_APP_EXE_NAME</label>
              <p class="form-hint">å•ç‹¬æŒ‡å®šexeåç§°,ä¹Ÿæ˜¯çª—å£çš„æ ‡é¢˜å</p>
              <input type="text" id="VITE_APP_EXE_NAME" class="form-input">
              <p class="error-text" id="VITE_APP_EXE_NAME_error">è¯·å¡«å†™å•ç‹¬æŒ‡å®šçš„exeåç§°</p>
            </div>
            <div>
              <label for="VITE_APP_DESC" class="form-label-required">VITE_APP_DESC</label>
              <p class="form-hint">åº”ç”¨æè¿°</p>
              <input type="text" id="VITE_APP_DESC" class="form-input">
              <p class="error-text" id="VITE_APP_DESC_error">è¯·å¡«å†™åº”ç”¨æè¿°</p>
            </div>
            <div>
              <label for="VITE_APP_ID" class="form-label-required">VITE_APP_ID</label>
              <p class="form-hint">åº”ç”¨çš„appId</p>
              <input type="text" id="VITE_APP_ID" class="form-input" value="electron.xxdl.xyz">
              <p class="error-text" id="VITE_APP_ID_error">è¯·å¡«å†™åº”ç”¨çš„appId</p>
            </div>
            <div>
              <label for="VITE_APP_ICON" class="form-label-required">VITE_APP_ICON</label>
              <p class="form-hint">åº”ç”¨å›¾æ ‡è·¯å¾„ï¼Œé»˜è®¤image/icon.png</p>
              <input type="text" id="VITE_APP_ICON" class="form-input" value="image/shein.png">
              <p class="error-text" id="VITE_APP_ICON_error">è¯·å¡«å†™åº”ç”¨å›¾æ ‡è·¯å¾„</p>
            </div>
            <div>
              <label for="VITE_APP_HOME" class="form-label-required">VITE_APP_HOME</label>
              <p class="form-hint">åº”ç”¨ä¸»é¡µ</p>
              <input type="text" id="VITE_APP_HOME" class="form-input">
              <p class="error-text" id="VITE_APP_HOME_error">è¯·å¡«å†™åº”ç”¨ä¸»é¡µåœ°å€</p>
            </div>
          </div>
        </section>

        <!-- ä½œè€…ä¿¡æ¯é…ç½®åŒº -->
        <section class="config-card">
          <h2 class="section-title">
            <i class="fa fa-user text-primary"></i> ä½œè€…ä¿¡æ¯é…ç½®
          </h2>
          <div class="space-y-4">
            <div>
              <label for="VITE_AUTHOR_NAME" class="form-label-required">VITE_AUTHOR_NAME</label>
              <p class="form-hint">ä½œè€…åç§°</p>
              <input type="text" id="VITE_AUTHOR_NAME" class="form-input" value="ç­±ç­±">
              <p class="error-text" id="VITE_AUTHOR_NAME_error">è¯·å¡«å†™ä½œè€…åç§°</p>
            </div>
            <div>
              <label for="VITE_AUTHOR_WX" class="form-label-required">VITE_AUTHOR_WX</label>
              <p class="form-hint">ä½œè€…å¾®ä¿¡</p>
              <input type="text" id="VITE_AUTHOR_WX" class="form-input" value="xxdlovo">
              <p class="error-text" id="VITE_AUTHOR_WX_error">è¯·å¡«å†™ä½œè€…å¾®ä¿¡</p>
            </div>
            <div>
              <label for="VITE_AUTHOR_WX_IMG" class="form-label-required">VITE_AUTHOR_WX_IMG</label>
              <p class="form-hint">ä½œè€…å¾®ä¿¡äºŒç»´ç çš„å›¾ç‰‡åï¼Œéœ€è¦æ”¾åœ¨image/ä¸­</p>
              <input type="text" id="VITE_AUTHOR_WX_IMG" class="form-input" value="image/wx_qr.png">
              <p class="error-text" id="VITE_AUTHOR_WX_IMG_error">è¯·å¡«å†™ä½œè€…å¾®ä¿¡äºŒç»´ç çš„å›¾ç‰‡å</p>
            </div>
            <div>
              <label for="VITE_AUTHOR_EMAIL" class="form-label-required">VITE_AUTHOR_EMAIL</label>
              <p class="form-hint">ä½œè€…é‚®ç®±</p>
              <input type="email" id="VITE_AUTHOR_EMAIL" class="form-input" value="dddgoal@163.com">
              <p class="error-text" id="VITE_AUTHOR_EMAIL_error">è¯·å¡«å†™æœ‰æ•ˆçš„ä½œè€…é‚®ç®±</p>
            </div>
          </div>
        </section>

        <!-- ç³»ç»Ÿé…ç½®åŒº -->
        <section class="config-card">
          <h2 class="section-title">
            <i class="fa fa-shield text-primary"></i> ç³»ç»Ÿé…ç½®
          </h2>
          <div class="space-y-4">
            <div>
              <label for="VITE_ADMIN_PASSWORD" class="form-label-required">VITE_ADMIN_PASSWORD</label>
              <p class="form-hint">æ§åˆ¶å°çš„ç®¡ç†å¯†ç </p>
              <input id="VITE_ADMIN_PASSWORD" class="form-input" value="123456">
              <p class="error-text" id="VITE_ADMIN_PASSWORD_error">è¯·è®¾ç½®æ§åˆ¶å°ç®¡ç†å¯†ç </p>
            </div>
          </div>
        </section>

        <!-- åº”ç”¨é“¾æ¥é…ç½®åŒºï¼ˆç‹¬ç«‹åˆ†åŒºï¼‰ -->
        <section class="config-card lg:col-span-2">
          <h2 class="section-title">
            <i class="fa fa-bookmark text-primary"></i> åº”ç”¨é“¾æ¥é…ç½®
          </h2>
          <p class="form-hint mb-4">æ¯è¡ŒåŒ…å«å›¾æ ‡ã€æ ‡é¢˜ã€é“¾æ¥ï¼Œè‡ªåŠ¨æ‹¼æ¥ä¸º VITE_APP_LINKS é…ç½®å€¼ï¼ˆæ ¼å¼ï¼šå›¾æ ‡|æ ‡é¢˜|é“¾æ¥;å›¾æ ‡|æ ‡é¢˜|é“¾æ¥ï¼‰ï¼Œæ‰€æœ‰å­—æ®µå‡ä¸ºå¿…å¡«</p>

          <!-- é“¾æ¥è¡Œå®¹å™¨ -->
          <div id="linksContainer" class="mb-4">
            <!-- åˆå§‹è¡Œ -->
            <div class="link-row">
              <div class="link-row-input">
                <label class="form-label-required">emojiå›¾æ ‡</label>
                <p class="form-hint">å¦‚ğŸ˜€ğŸ™ƒ</p>
                <input type="text" class="form-input link-icon" value="ğŸ˜€">
                <p class="error-text link-icon-error">è¯·å¡«å†™emojiå›¾æ ‡</p>
              </div>
              <div class="link-row-input">
                <label class="form-label-required">é“¾æ¥æ ‡é¢˜</label>
                <p class="form-hint">é“¾æ¥çš„æ˜¾ç¤ºæ ‡é¢˜ï¼Œä¾‹å¦‚ï¼šä½¿ç”¨æ–‡æ¡£</p>
                <input type="text" class="form-input link-title" value="ä½¿ç”¨æ–‡æ¡£">
                <p class="error-text link-title-error">è¯·å¡«å†™é“¾æ¥æ ‡é¢˜</p>
              </div>
              <div class="link-row-input">
                <label class="form-label-required">é“¾æ¥åœ°å€</label>
                <p class="form-hint">é“¾æ¥çš„URLåœ°å€ï¼Œä¾‹å¦‚ï¼šhttps://docs.example.com</p>
                <input type="text" class="form-input link-url" value="https://dcnjo468lptb.feishu.cn/wiki/G5i9wLMnNi6UCbke223caiGCnyg">
                <p class="error-text link-url-error">è¯·å¡«å†™é“¾æ¥åœ°å€</p>
              </div>
              <button type="button" class="btn btn-danger delete-row" style="padding: 0.5rem 1rem;">
                <i class="fa fa-trash"></i>
              </button>
            </div>
          </div>

          <!-- æ–°å¢è¡ŒæŒ‰é’® -->
          <button type="button" id="addLinkRow" class="btn btn-secondary">
            <i class="fa fa-plus mr-1"></i> æ–°å¢é“¾æ¥è¡Œ
          </button>

          <!-- éšè—çš„VITE_APP_LINKSè¾“å…¥æ¡†ï¼ˆç”¨äºç”Ÿæˆé…ç½®ï¼‰ -->
          <input type="hidden" id="VITE_APP_LINKS">
        </section>
      </div>
    </div>

    <!-- å³ä¾§ï¼šæŒ‰é’®åŒºï¼ˆå›ºå®šå®½åº¦ï¼Œç²˜æ€§å¸ƒå±€ï¼‰ -->
    <div class="w-full lg:w-1/6">
      <div class="action-btn sticky top-8">
        <button id="resetBtn" class="btn btn-secondary w-full">
          <i class="fa fa-refresh mr-1"></i> é‡ç½®
        </button>
        <button id="saveBtn" class="btn btn-primary w-full">
          <i class="fa fa-save mr-1"></i> ä¿å­˜é…ç½®
        </button>
        <!-- å¯æ‰©å±•æ·»åŠ æ›´å¤šæŒ‰é’® -->
        <button id="previewBtn" class="btn btn-secondary w-full">
          <i class="fa fa-eye mr-1"></i> åˆ·æ–°é¢„è§ˆ
        </button>
      </div>
    </div>
  </div>
</div>

<script>
  // é…ç½®é¡¹åˆ—è¡¨ï¼ˆåŒ…å«éšè—çš„VITE_APP_LINKSï¼‰
  const configItems = [
    'VITE_UL_CONF_AK', 'VITE_UL_CONF_SK', 'VITE_UL_CONF_FILEKEY', 'VITE_UL_CONF_URL',
    'VITE_APP_NAME', 'VITE_APP_EXE_NAME', 'VITE_APP_DESC', 'VITE_APP_ID', 'VITE_APP_ICON',
    'VITE_APP_HOME', 'VITE_APP_LINKS', 'VITE_AUTHOR_NAME', 'VITE_AUTHOR_WX',
    'VITE_AUTHOR_WX_IMG', 'VITE_AUTHOR_EMAIL', 'VITE_ADMIN_PASSWORD'
  ];

  // æ‰€æœ‰é…ç½®é¡¹è®¾ä¸ºå¿…å¡«ï¼ˆåŒ…å«æ™®é€šé¡¹å’Œé‚®ç®±æ ¼å¼é¡¹ï¼‰
  const requiredFields = [
    { id: 'VITE_UL_CONF_AK', rule: 'required', message: 'è¯·å¡«å†™UpgradeLinkå¹³å°çš„AK' },
    { id: 'VITE_UL_CONF_SK', rule: 'required', message: 'è¯·å¡«å†™UpgradeLinkå¹³å°çš„SK' },
    { id: 'VITE_UL_CONF_FILEKEY', rule: 'required', message: 'è¯·å¡«å†™UpgradeLinkå¹³å°çš„FileKey' },
    { id: 'VITE_UL_CONF_URL', rule: 'required', message: 'è¯·å¡«å†™ç¨‹åºå¯åŠ¨åæ‰“å¼€çš„åœ°å€' },
    { id: 'VITE_APP_NAME', rule: 'required', message: 'è¯·å¡«å†™åº”ç”¨åç§°' },
    { id: 'VITE_APP_EXE_NAME', rule: 'required', message: 'è¯·å¡«å†™å•ç‹¬æŒ‡å®šçš„exeåç§°' },
    { id: 'VITE_APP_DESC', rule: 'required', message: 'è¯·å¡«å†™åº”ç”¨æè¿°' },
    { id: 'VITE_APP_ID', rule: 'required', message: 'è¯·å¡«å†™åº”ç”¨çš„appId' },
    { id: 'VITE_APP_ICON', rule: 'required', message: 'è¯·å¡«å†™åº”ç”¨å›¾æ ‡è·¯å¾„' },
    { id: 'VITE_APP_HOME', rule: 'required', message: 'è¯·å¡«å†™åº”ç”¨ä¸»é¡µåœ°å€' },
    { id: 'VITE_AUTHOR_NAME', rule: 'required', message: 'è¯·å¡«å†™ä½œè€…åç§°' },
    { id: 'VITE_AUTHOR_WX', rule: 'required', message: 'è¯·å¡«å†™ä½œè€…å¾®ä¿¡' },
    { id: 'VITE_AUTHOR_WX_IMG', rule: 'required', message: 'è¯·å¡«å†™ä½œè€…å¾®ä¿¡äºŒç»´ç çš„å›¾ç‰‡å' },
    { id: 'VITE_AUTHOR_EMAIL', rule: 'email', message: 'è¯·å¡«å†™æœ‰æ•ˆçš„ä½œè€…é‚®ç®±' },
    { id: 'VITE_ADMIN_PASSWORD', rule: 'required', message: 'è¯·è®¾ç½®æ§åˆ¶å°ç®¡ç†å¯†ç ' }
  ];

  // ç”Ÿæˆé“¾æ¥é…ç½®å­—ç¬¦ä¸²å¹¶æ ¡éªŒé“¾æ¥è¡Œ
  function generateLinksConfig() {
    const linkRows = document.querySelectorAll('.link-row');
    const links = [];
    let isLinksValid = true;

    // æ¸…é™¤æ‰€æœ‰é“¾æ¥è¡Œçš„é”™è¯¯æç¤º
    linkRows.forEach(row => {
      row.querySelector('.link-icon').classList.remove('form-input-error');
      row.querySelector('.link-title').classList.remove('form-input-error');
      row.querySelector('.link-url').classList.remove('form-input-error');
      row.querySelector('.link-icon-error').classList.remove('show');
      row.querySelector('.link-title-error').classList.remove('show');
      row.querySelector('.link-url-error').classList.remove('show');
    });

    // æ ¡éªŒå¹¶æ‹¼æ¥é“¾æ¥è¡Œ
    linkRows.forEach(row => {
      const icon = row.querySelector('.link-icon').value.trim();
      const title = row.querySelector('.link-title').value.trim();
      const url = row.querySelector('.link-url').value.trim();
      const iconError = row.querySelector('.link-icon-error');
      const titleError = row.querySelector('.link-title-error');
      const urlError = row.querySelector('.link-url-error');

      // æ ¡éªŒé“¾æ¥è¡Œçš„å¿…å¡«é¡¹
      if (!icon) {
        row.querySelector('.link-icon').classList.add('form-input-error');
        iconError.classList.add('show');
        isLinksValid = false;
      }
      if (!title) {
        row.querySelector('.link-title').classList.add('form-input-error');
        titleError.classList.add('show');
        isLinksValid = false;
      }
      if (!url) {
        row.querySelector('.link-url').classList.add('form-input-error');
        urlError.classList.add('show');
        isLinksValid = false;
      }

      // åªæœ‰æ‰€æœ‰å­—æ®µéƒ½æœ‰å€¼æ—¶æ‰åŠ å…¥
      if (icon && title && url) {
        links.push(`${icon}|${title}|${url}`);
      }
    });

    // å°†æ‹¼æ¥ç»“æœå†™å…¥éšè—è¾“å…¥æ¡†
    const linksConfig = links.join(';');
    document.getElementById('VITE_APP_LINKS').value = linksConfig;

    // è¿”å›æ‹¼æ¥ç»“æœå’Œæ ¡éªŒçŠ¶æ€
    return { config: linksConfig, valid: isLinksValid };
  }

  // åˆå§‹åŒ–é¢„è§ˆ
  function updatePreview() {
    // å…ˆç”Ÿæˆé“¾æ¥é…ç½®ï¼ˆä¸æ ¡éªŒï¼Œä»…æ›´æ–°é¢„è§ˆï¼‰
    const { config } = generateLinksConfig();

    let configContent = '';
    configItems.forEach(key => {
      const value = document.getElementById(key).value.trim();
      if (value) {
        configContent += `${key}=${value}\n`;
      }
    });
    document.getElementById('configPreview').textContent = configContent || '# è¯·å¡«å†™é…ç½®é¡¹ä»¥ç”Ÿæˆå†…å®¹';
  }

  // å…¨å±€è¡¨å•æ ¡éªŒå‡½æ•°
  function validateForm() {
    let isValid = true;

    // æ¸…é™¤æ‰€æœ‰æ™®é€šé¡¹é”™è¯¯æç¤º
    requiredFields.forEach(field => {
      const input = document.getElementById(field.id);
      const errorText = document.getElementById(`${field.id}_error`);
      if (input) {
        input.classList.remove('form-input-error');
        if (errorText) errorText.classList.remove('show');
      }
    });

    // æ ¡éªŒæ™®é€šå¿…å¡«é¡¹
    requiredFields.forEach(field => {
      const input = document.getElementById(field.id);
      if (!input) return;

      const value = input.value.trim();
      const errorText = document.getElementById(`${field.id}_error`);

      // éç©ºæ ¡éªŒ
      if (field.rule === 'required' && !value) {
        input.classList.add('form-input-error');
        errorText.textContent = field.message;
        errorText.classList.add('show');
        isValid = false;
      }

      // é‚®ç®±æ ¼å¼æ ¡éªŒ
      if (field.rule === 'email' && value) {
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!emailRegex.test(value)) {
          input.classList.add('form-input-error');
          errorText.textContent = field.message;
          errorText.classList.add('show');
          isValid = false;
        }
      }
    });

    // æ ¡éªŒé“¾æ¥é…ç½®è¡Œ
    const { valid: linksValid } = generateLinksConfig();
    if (!linksValid) {
      isValid = false;
    }

    return isValid;
  }

  // å¤åˆ¶é…ç½®å†…å®¹
  function copyConfig() {
    const preview = document.getElementById('configPreview');
    const text = preview.textContent;
    navigator.clipboard.writeText(text).then(() => {
      const copyBtn = document.getElementById('copyBtn');
      const originalText = copyBtn.innerHTML;
      copyBtn.innerHTML = '<i class="fa fa-check mr-1"></i> å·²å¤åˆ¶';
      setTimeout(() => {
        copyBtn.innerHTML = originalText;
      }, 2000);
    }).catch(err => {
      alert('å¤åˆ¶å¤±è´¥ï¼š' + err);
    });
  }

  // ä¸‹è½½é…ç½®æ–‡ä»¶
  function downloadConfig() {
    // å…ˆè¿›è¡Œè¡¨å•æ ¡éªŒ
    if (!validateForm()) {
      alert('è¯·å®Œå–„æ‰€æœ‰å¿…å¡«é…ç½®é¡¹åå†ä¿å­˜ï¼');
      return;
    }

    const fileName = document.getElementById('fileName').value.trim() || '.env';
    const content = document.getElementById('configPreview').textContent;
    const blob = new Blob([content], { type: 'text/plain' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = fileName;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);

    // æ˜¾ç¤ºä¿å­˜æˆåŠŸæç¤º
    const saveBtn = document.getElementById('saveBtn');
    const originalText = saveBtn.innerHTML;
    saveBtn.innerHTML = '<i class="fa fa-check mr-1"></i> å·²ä¿å­˜';
    setTimeout(() => {
      saveBtn.innerHTML = originalText;
    }, 2000);
  }

  // é‡ç½®è¡¨å•
  function resetForm() {
    if (confirm('ç¡®å®šè¦é‡ç½®æ‰€æœ‰é…ç½®é¡¹å—ï¼Ÿ')) {
      // é‡ç½®æ™®é€šé…ç½®é¡¹
      configItems.forEach(key => {
        const input = document.getElementById(key);
        if (!input) return;

        // ä¿ç•™é»˜è®¤å€¼
        if (key === 'VITE_UL_CONF_URL') input.value = 'http://localhost:3000';
        else if (key === 'VITE_APP_ICON') input.value = 'image/icon.png';
        else input.value = '';

        // æ¸…é™¤é”™è¯¯æ ·å¼
        input.classList.remove('form-input-error');
        const errorText = document.getElementById(`${key}_error`);
        if (errorText) errorText.classList.remove('show');
      });

      // é‡ç½®é“¾æ¥é…ç½®åŒº
      const linksContainer = document.getElementById('linksContainer');
      linksContainer.innerHTML = `
          <div class="link-row">
            <div class="link-row-input">
              <label class="form-label-required">å›¾æ ‡ç±»å</label>
              <p class="form-hint">Font Awesomeå›¾æ ‡ç±»åï¼Œä¾‹å¦‚ï¼šfa fa-book</p>
              <input type="text" class="form-input link-icon" value="fa fa-book">
              <p class="error-text link-icon-error">è¯·å¡«å†™å›¾æ ‡ç±»å</p>
            </div>
            <div class="link-row-input">
              <label class="form-label-required">é“¾æ¥æ ‡é¢˜</label>
              <p class="form-hint">é“¾æ¥çš„æ˜¾ç¤ºæ ‡é¢˜ï¼Œä¾‹å¦‚ï¼šä½¿ç”¨æ–‡æ¡£</p>
              <input type="text" class="form-input link-title">
              <p class="error-text link-title-error">è¯·å¡«å†™é“¾æ¥æ ‡é¢˜</p>
            </div>
            <div class="link-row-input">
              <label class="form-label-required">é“¾æ¥åœ°å€</label>
              <p class="form-hint">é“¾æ¥çš„URLåœ°å€ï¼Œä¾‹å¦‚ï¼šhttps://docs.example.com</p>
              <input type="text" class="form-input link-url">
              <p class="error-text link-url-error">è¯·å¡«å†™é“¾æ¥åœ°å€</p>
            </div>
            <button type="button" class="btn btn-danger delete-row" style="padding: 0.5rem 1rem;">
              <i class="fa fa-trash"></i>
            </button>
          </div>
        `;
      // é‡æ–°ç»‘å®šåˆ é™¤è¡Œäº‹ä»¶
      bindDeleteRowEvents();
      // é‡æ–°ç»‘å®šé“¾æ¥è¡Œè¾“å…¥äº‹ä»¶
      bindAllLinkRowInputEvents();

      document.getElementById('fileName').value = '.env';
      updatePreview();
    }
  }

  // æ–°å¢é“¾æ¥è¡Œ
  function addLinkRow() {
    const linksContainer = document.getElementById('linksContainer');
    const newRow = document.createElement('div');
    newRow.className = 'link-row';
    newRow.innerHTML = `
        <div class="link-row-input">
          <label class="form-label-required">emojiå›¾æ ‡</label>
          <p class="form-hint">å¦‚ğŸ˜€ğŸ™ƒ</p>
          <input type="text" class="form-input link-icon" value="fa fa-book">
          <p class="error-text link-icon-error">è¯·å¡«å†™emojiå›¾æ ‡/p>
        </div>
        <div class="link-row-input">
          <label class="form-label-required">é“¾æ¥æ ‡é¢˜</label>
          <p class="form-hint">é“¾æ¥çš„æ˜¾ç¤ºæ ‡é¢˜ï¼Œä¾‹å¦‚ï¼šä½¿ç”¨æ–‡æ¡£</p>
          <input type="text" class="form-input link-title">
          <p class="error-text link-title-error">è¯·å¡«å†™é“¾æ¥æ ‡é¢˜</p>
        </div>
        <div class="link-row-input">
          <label class="form-label-required">é“¾æ¥åœ°å€</label>
          <p class="form-hint">é“¾æ¥çš„URLåœ°å€ï¼Œä¾‹å¦‚ï¼šhttps://docs.example.com</p>
          <input type="text" class="form-input link-url">
          <p class="error-text link-url-error">è¯·å¡«å†™é“¾æ¥åœ°å€</p>
        </div>
        <button type="button" class="btn btn-danger delete-row" style="padding: 0.5rem 1rem;">
          <i class="fa fa-trash"></i>
        </button>
      `;
    linksContainer.appendChild(newRow);

    // ç»‘å®šæ–°è¡Œçš„åˆ é™¤äº‹ä»¶
    newRow.querySelector('.delete-row').addEventListener('click', function() {
      if (document.querySelectorAll('.link-row').length > 1) {
        newRow.remove();
        updatePreview();
      } else {
        alert('è‡³å°‘éœ€è¦ä¿ç•™ä¸€è¡Œé“¾æ¥é…ç½®');
      }
    });

    // ç»‘å®šè¾“å…¥äº‹ä»¶
    bindLinkRowInputEvents(newRow);
    updatePreview();
  }

  // ç»‘å®šåˆ é™¤è¡Œäº‹ä»¶
  function bindDeleteRowEvents() {
    document.querySelectorAll('.delete-row').forEach(btn => {
      btn.addEventListener('click', function() {
        const row = this.closest('.link-row');
        if (document.querySelectorAll('.link-row').length > 1) {
          row.remove();
          updatePreview();
        } else {
          alert('è‡³å°‘éœ€è¦ä¿ç•™ä¸€è¡Œé“¾æ¥é…ç½®');
        }
      });
    });
  }

  // ç»‘å®šé“¾æ¥è¡Œè¾“å…¥äº‹ä»¶
  function bindLinkRowInputEvents(row) {
    const inputs = row.querySelectorAll('input');
    inputs.forEach(input => {
      input.addEventListener('input', () => {
        // è¾“å…¥æ—¶æ¸…é™¤å½“å‰è¾“å…¥æ¡†çš„é”™è¯¯æç¤º
        input.classList.remove('form-input-error');
        const errorEl = input.nextElementSibling;
        if (errorEl && errorEl.classList.contains('error-text')) {
          errorEl.classList.remove('show');
        }
        updatePreview();
      });
    });
  }

  // ç»‘å®šæ‰€æœ‰é“¾æ¥è¡Œè¾“å…¥äº‹ä»¶
  function bindAllLinkRowInputEvents() {
    document.querySelectorAll('.link-row').forEach(row => {
      bindLinkRowInputEvents(row);
    });
  }

  // ç»‘å®šäº‹ä»¶
  document.addEventListener('DOMContentLoaded', () => {
    // åˆå§‹åŒ–é¢„è§ˆ
    updatePreview();

    // ç›‘å¬æ™®é€šé…ç½®é¡¹è¾“å…¥å˜åŒ–
    configItems.forEach(key => {
      const input = document.getElementById(key);
      if (input && !input.hidden) {
        input.addEventListener('input', () => {
          updatePreview();
          // è¾“å…¥æ—¶æ¸…é™¤å¯¹åº”é”™è¯¯æç¤º
          const errorText = document.getElementById(`${key}_error`);
          if (errorText) {
            input.classList.remove('form-input-error');
            errorText.classList.remove('show');
          }
        });
      }
    });
    document.getElementById('fileName').addEventListener('input', updatePreview);

    // ç»‘å®šé“¾æ¥é…ç½®åŒºäº‹ä»¶
    bindDeleteRowEvents();
    bindAllLinkRowInputEvents();
    document.getElementById('addLinkRow').addEventListener('click', addLinkRow);

    // ç»‘å®šæŒ‰é’®äº‹ä»¶
    document.getElementById('copyBtn').addEventListener('click', copyConfig);
    document.getElementById('saveBtn').addEventListener('click', downloadConfig);
    document.getElementById('resetBtn').addEventListener('click', resetForm);
    document.getElementById('previewBtn').addEventListener('click', updatePreview); // æ–°å¢åˆ·æ–°é¢„è§ˆæŒ‰é’®

    // ä¸ºæ‰€æœ‰å¿…å¡«é¡¹æ·»åŠ å¤±å»ç„¦ç‚¹æ ¡éªŒ
    requiredFields.forEach(field => {
      const input = document.getElementById(field.id);
      if (input) {
        input.addEventListener('blur', () => {
          const value = input.value.trim();
          const errorText = document.getElementById(`${field.id}_error`);

          if (field.rule === 'required' && !value) {
            input.classList.add('form-input-error');
            errorText.textContent = field.message;
            errorText.classList.add('show');
          } else if (field.rule === 'email' && value) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(value)) {
              input.classList.add('form-input-error');
              errorText.textContent = field.message;
              errorText.classList.add('show');
            }
          }
        });
      }
    });

    // ä¸ºé“¾æ¥è¡Œè¾“å…¥æ¡†æ·»åŠ å¤±å»ç„¦ç‚¹æ ¡éªŒ
    document.addEventListener('blur', function(e) {
      if (e.target.classList.contains('link-icon') || e.target.classList.contains('link-title') || e.target.classList.contains('link-url')) {
        const value = e.target.value.trim();
        if (!value) {
          e.target.classList.add('form-input-error');
          const errorEl = e.target.nextElementSibling;
          if (errorEl && errorEl.classList.contains('error-text')) {
            errorEl.classList.add('show');
          }
        }
      }
    }, true);
  });
</script>
</body>
</html>
